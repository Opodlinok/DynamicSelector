# CHANGELOG

Все заметные изменения этого проекта документируются в этом файле.  
Этот проект использует [Семантическое версионирование](https://semver.org/).  

---

## [0.17.1] - 2025-06-09
### Fixed
- Исправлено: `SortManager` не вызывал переотрисовку офферов при применении.

---

## [0.17.0] - 2025-06-09
### Added
- В `RangeFilter` новая опция `ExtractDigitsFromString` — при включении извлекает первую группу цифр (с учётом буквенного суффикса) из строковых полей и строит диапазон по этим числам.  

### Changed
- Теперь если в поле `RangeFilter` нет ни одной цифры, `TwinSlider` автоматически деактивируется.

### Fixed
- В `FeedManager.DisplayOffers` теперь перед выводом офферов вызывается сортировка через `sortManager.ApplySorting`.

---

## [0.16.0] - 2025-04-18
### Added
- Добавлен функционал сортировки офферов по их параметрам в порядке возрастания и убывания. См. `SortManager`.

### Changed
- `OfferParser` и `OfferData` теперь могут обрабатывать одноимённые элементы, помещая их в массив.

---

## [0.15.0] - 2025-03-03
### Added
- Добавлен тестовый - вспомогательный класс `TextFormatterWatcher` (_Plugins/DynamicSelector/Sample/Scripts/..._), позволяющий любым текстовым полям считывать `Formatter` теги.

### Changed
- В `Formatter` добавлен новый тег `<wordraw:N>` — взять N слово из строки игнорируя спец. символы.
- Временно отключены `after` и `before` теги форматирования.

---

## [0.14.0] - 2025-02-21
### Added
- Новый тип фильтра: `ConditionDropdownFilter`. Это альтернатива `DropdownFilter`, работающая по принципу `Switcher` или `DictionaryToggleGroup`.
- `ConditionDropdownFilter` позволяет заранее задать фиксированные опции, каждая из которых соответствует одному или нескольким условиям (FieldCondition).
- Добавлена поддержка логики `<included>` и `<excluded>` в `ConditionDropdownFilter`, позволяющая фильтровать офферы по наличию или отсутствию конкретных значений.
- Теперь в `ConditionDropdownFilter` можно включать специальную опцию «Показать всё» (опционально).

### Changed
- `FilterManager` теперь поддерживает обновление `ConditionDropdownFilter` и корректно обрабатывает его в системе фильтрации.
- Логика `Matches()` в `ConditionDropdownFilter` теперь более гибкая: поддерживает точное совпадение, поиск подстроки и исключение значений.
- Оптимизирована работа `Dropdown` при обновлении списка офферов – теперь состояние выбора сохраняется корректно.
- `ConditionDropdownFilter` теперь корректно обрабатывает множественные включённые фильтры, обеспечивая AND-логику.

### Fixed
- Исправлено: `ConditionDropdownFilter` теперь корректно сохраняет выбранные значения и обновляет UI при изменении офферов.
- Исправлено: при выборе нескольких фильтров в `ConditionDropdownFilter` больше не возникает ситуации, когда число отображаемых офферов неожиданно увеличивается.
- Исправлено: теперь логика выбора в `Dropdown` корректно работает, если `OneOptionMode` отключён.
- Исправлено: корректно обновляется отображение `Dropdown` после применения фильтров, даже если состояние фильтрации изменилось в ходе работы.

---

## [0.13.0] - 2025-02-09
### Added
- Полностью переработан `DropdownFilter`. Теперь он поддерживает множественные `FieldName(s)`, указанные через `;`.
- Добавлена система `Template`, позволяющая кастомизировать отображение значений Dropdown, порядок подстановки значений.
- Теперь `DropdownFilter` автоматически анализирует все уникальные значения указанных полей и создает `Options` без необходимости ручного заполнения.

### Changed
- Улучшен `DropdownFilterDrawer`: теперь `Template` строится динамически на основе `FieldNames`, и его можно редактировать без ручного форматирования.
- `FilterManager` теперь автоматически вызывает `PopulateOptionsFromOffers` при обновлении списка офферов, обеспечивая синхронизацию данных.
- `DropdownFilter.IsMatch` теперь корректно сравнивает сложные ключи формата, а не только `rawKey`.

### Fixed
- Исправлено: `DropdownFilter` больше не дублирует значения при повторном открытии `Dropdown`.
- Исправлено: теперь офферы корректно отображаются при выборе значений из `DropdownFilter`, даже если в нем несколько `FieldNames`.
- Исправлено: при удалении всех значений в `FieldNames` теперь `Template` полностью очищается, не оставляя артефактов.
- Исправлено: корректно сохраняются `prefixes` и `suffixes` для каждого сегмента `Template`.
- Исправлено: `DropdownFilterDrawer` больше не сбрасывает `FieldNames` при переключении инспектора.
- Исправлено: значения `SelectedOptions` теперь корректно сохраняются между сценами и при перезапуске Unity.
- Исправлено: некорректная верстка последнего патчноута в UnityEditor.

---

## [0.12.1] - 2025-02-08
### Fixed
- Исправлено: удаление BOM теперь происходит только при обнаружении символа `\uFEFF` в **первом** байте. Ранее использовался `Trim`, который мог ошибочно обрезать открывающий `<` и ломать парсинг XML.

---

## [0.12.0] - 2025-01-04
### Added
- Добавлена поддержка новых тегов `<after:"...">` и `<before:"...">` в Formatter. Теперь можно извлекать следующее или предыдущее слово относительно заданного «маяка».
- `<included>` и `<excluded>` добавлены в ConditionalMappings `OfferView`
- Теперь у плагина есть wiki документация доступная [по ссылке](https://github.com/Opodlinok/DynamicSelector/wiki), а также через интерфейс плагина в Unity.

### Changed
- В регулярном выражении FormatToken расширен параметр `param` (теперь разрешены пробелы и другие символы, кроме `>`).

### Fixed
- Исправлено: Switcher невозможно было переключить при выключенном interactable.

---

## [0.11.0] - 2024-12-24
### Added
- Добавлена логика тегов `<included>` и `<excluded>` и точного сравнения в `DictionaryToggleFilter` — все варианты проверок (включение, исключение, точное совпадение, отсутствие поля) теперь объединены в едином механизме.

### Changed
- Обновлён пример использования в Sample-сцене.

### Fixed
- Исправлено: некорректно обрабатывались символы при сравнении строк в `FilterCondition`.
- Исправлено: скрытые поля некоторых классов могли отображаться в инспекторе.

---

## [0.10.0] - 2024-12-24
### Added
- Добавлена возможность исключить все офферы, кроме определённых используя included в FeedManager.

### Changed
- Теперь в `DictionaryToggleFilter` можно использовать сразу несколько полей и значений для одного переключателя.

### Fixed
- Исправлено: не учитывались и не удалялись нежелательные символы и BOM (Byte Order Mark) в теле фида.

---

## [0.9.1] - 2024-12-10
### Added
- Добавлен шейдер анимации для плейсхолдеров загрузки и тестовый скрипт для управления этой анимацией.

### Changed
- В проекте теперь используется семантическое версирование.
- Убраны ограничения при использовании старых версий плагина (начиная с 0.9.1).
- Изменена структура Sample.

---

## [0.9.0] - 2024-12-04
### Added
- Вспомогательный класс `OptimizedScrollRect` для улучшения оптимизации.
- Сервис для асинхронной загрузки и кэширования изображений.
- Альтернативный `FeedManager`, поддерживающий `OptimizedScrollRect`.

### Fixed
- Проблема инициализации `OfferData` внутри `OfferView`.

---

## [0.8.0] - 2024-12-03
### Added
- Возможность использования плейсхолдеров для текстовых полей в `OfferView`.
- Блокировка редактирования компонентов плагина без обновления через Debug режим инспектора.
- Дополнительные проверки некорректных значений в полях `OfferView`.
- Настройка для сброса `OfferView` при передаче новых данных через `OfferTransfer`.

### Changed
- Внешний вид `OfferView`.
- Дизайн принудительного окна блокировки плагина без обновления.

### Fixed
- Игнорирование лишних символов при обработке ссылок.
- Ссылки без `http/https` больше не обрабатываются.

---

## [0.7.1] - 2024-12-02
### Fixed
- Критическая ошибка инициализации `UI.Selectable.Reset` в Runtime.
- Проблема с вёрсткой в `AboutProject`.
- Значения `RectTransform` у `Fill` в `RangeSlider` больше не становятся `NaN` при некорректных данных.

---

## [0.7.0] - 2024-12-01
### Added
- Функция восстановления всех `Graphic` элементов `OfferView` к исходному состоянию.
- Возможность указывать отсутствие поля в оффере для фильтра `DictionaryToggles`.

### Changed
- Разделение плагина на `Editor.dll` и `Runtime.dll`.

### Fixed
- Границы `Range` теперь восстанавливаются по умолчанию при сбросе фильтров.
- Несоответствие ответственности некоторых Editor-скриптов.

---

## [0.6.0] - 2024-11-30
### Added
- Последовательная загрузка офферов в `FeedManager`.
- Поддержка списка одинаковых элементов.
- C#-скрипт `OfferTransfer` для передачи данных между `OfferView`.
- Функция отслеживания начала и завершения конструирования `OfferView`.
- Возможность работы с приватными данными офферов через `FeedManager.Offers` и `OfferView.OfferData`.

### Changed
- Перемещение плагина в директорию `Assets/Plugins/Opodlinok/DynamicSelector™`.

### Fixed
- Ошибка форматирования чисел с плавающей запятой.
- Критическая ошибка, останавливающая выполнение программы при невозможности проверки обновлений.

---

## [0.5.0] - 2024-11-28
### Added
- Интерфейс `UnityEditor` для настройки плагина.
- Система автоматической проверки обновлений.
- Блокировка `UnityEditor`, если доступна новая версия.

### Changed
- Структура проекта.

### Fixed
- Устранены баги и ошибки в функционале.

---

## [0.4.0] - 2024-11-27
### Added
- Сборка проекта в формате `.dll`.
- Проприетарная лицензия для ПО.
- Сервис обновлений и автоматической установки новых версий плагина.
- Репозиторий проекта.

### Changed
- Улучшения в архитектуре и рефакторинг кода.

---

## [0.3.0] - 2024-11-25
### Added
- Система фильтрации офферов через `FilterManager`.
- Новые типы фильтров.
- Автоматическое обновление списка офферов в `FeedManager` в зависимости от активных фильтров.

### Changed
- Интеграция плагина с `Opodlinok UI`.

---

## [0.2.0] - 2024-11-22
### Added
- Базовый класс `OfferView` для управления значениями офферов.
- UnityEditor классы для настройки скриптов.
- Механизм `ConditionalMappings` и `DefaultValues` в `OfferView`.

### Fixed
- Поведение `FeedManager` при распределении офферов.

---

## [0.1.0] - 2024-11-16
### Added
- Базовая структура проекта.
- Классы `FeedManager`, `FeedParser` и `FeedLoader` для распределения и обработки офферов.
